import streamlit as st
import requests
import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(page_title="–¢–∏–º –ë—ë—Ä—Ç–æ–Ω - –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π", layout="wide")

# –ü–æ–ª—É—á–∞–µ–º Groq API –∫–ª—é—á
if 'GROQ_API_KEY' in st.secrets:
    GROQ_API_KEY = st.secrets['GROQ_API_KEY']
else:
    st.error("–ö–ª—é—á GROQ_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö.")
    GROQ_API_KEY = None

st.title("üßõ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π: –¢–∏–º –ë—ë—Ä—Ç–æ–Ω")
st.markdown("–ü–æ–∏—Å–∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –¥–∞—Ç —Ä–µ–ª–∏–∑–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–≤—å—é.")

def search_news(query):
    """–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Groq API —Å –∑–∞–ø—Ä–æ—Å–æ–º —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã –∏ —Å—Å—ã–ª–æ–∫"""
    if not GROQ_API_KEY:
        return None
        
    url = "https://api.groq.com/openai/v1/chat/completions"
    headers = {
        "Authorization": f"Bearer {GROQ_API_KEY}",
        "Content-Type": "application/json"
    }
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –ø–æ–Ω–∏–º–∞–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Ä–µ–º–µ–Ω–∏
    current_date = datetime.datetime.now().strftime("%d.%m.%Y")
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç, —Ç—Ä–µ–±—É—é—â–∏–π –¥–∞—Ç—É, –≤—Ä–µ–º—è –∏ —Å—Å—ã–ª–∫–∏
    prompt = f"""
    –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞: {current_date}.
    –¢—ã ‚Äî –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É –¢–∏–º–∞ –ë—ë—Ä—Ç–æ–Ω–∞.
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∑–∞–ø—Ä–æ—Å—É: "{query}".
    
    –ù–∞–π–¥–∏ 3-4 –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–∞ –∏–ª–∏ –Ω–æ–≤–æ—Å—Ç–∏.
    –î–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ—Å—Ç–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç (–∏—Å–ø–æ–ª—å–∑—É–π Markdown):
    
    ### üé¨ [–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏]
    üìÖ **–î–∞—Ç–∞/–ü–µ—Ä–∏–æ–¥:** [–£–∫–∞–∂–∏ –¥–∞—Ç—É –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è]
    üîó **–ò—Å—Ç–æ—á–Ω–∏–∫:** [–£–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –≤—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ: [–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞](https://—Å—Å—ã–ª–∫–∞)]
    üìù **–°—É—Ç—å:** [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏]
    
    ---
    
    –ï—Å–ª–∏ —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏, —É–∫–∞–∂–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –∏–ª–∏ IMDB. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ URL.
    """
    
    data = {
        "messages": [{"role": "user", "content": prompt}],
        "model": "llama-3.1-8b-instant", # –ò–ª–∏ llama3-70b-8192 –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
        "temperature": 0.5 # –°–Ω–∏–∂–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, —á—Ç–æ–±—ã –º–µ–Ω—å—à–µ –≤—ã–¥—É–º—ã–≤–∞–ª
    }
    
    try:
        response = requests.post(url, headers=headers, json=data)
        if response.status_code == 200:
            result = response.json()
            return result['choices'][0]['message']['content']
        else:
            return f"–û—à–∏–±–∫–∞ API: {response.status_code}"
    except Exception as e:
        return f"–û—à–∏–±–∫–∞: {str(e)}"

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∏—Å–∫–∞
st.header("üîç –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞")
search_query = st.text_input("", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–∏—Ç–ª–¥–∂—É—Å 2 –∞–∫—Ç–µ—Ä—ã, –í—ã—Å—Ç–∞–≤–∫–∞ –ë—ë—Ä—Ç–æ–Ω–∞ 2024...")

if search_query:
    with st.spinner("–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."):
        results = search_news(search_query)
        
        if results:
            st.subheader(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É: {search_query}")
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º markdown –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –∏ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            st.markdown(results)
            
            st.warning("‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –°—Å—ã–ª–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º. –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ –≤ Google.")
        else:
            st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á.")

# –ü—Ä–∏–º–µ—Ä—ã
with st.expander("üìå –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)"):
    st.code("–ö–æ–≥–¥–∞ –≤—ã–π–¥–µ—Ç –£—ç–¥–Ω–µ—Å–¥—ç–π 2 —Å–µ–∑–æ–Ω?")
    st.code("–ë–∏—Ç–ª–¥–∂—É—Å 2 –¥–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ –≤ –º–∏—Ä–µ")
    st.code("–¢–∏–º –ë—ë—Ä—Ç–æ–Ω –∏ –ú–æ–Ω–∏–∫–∞ –ë–µ–ª–ª—É—á—á–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏")

# –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —Å –≤–∞—à–∏–º –¥–∏–∑–∞–π–Ω–æ–º
st.markdown("---")
if st.button("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", use_container_width=True, key="back_news"):
    st.markdown("""
    <div style='background-color: #2b2b2b; padding: 15px; border-radius: 10px; border: 1px solid #f0e68c;'>
        <h4 style='color: #f0e68c; margin-top: 0;'>–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</h4>
        <p style='margin-bottom: 10px;'>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ:</p>
        <a href='https://quixotic-shrimp-ea9.notion.site/9aabb68bd7004965819318e32d8ff06e?v=2b4a0ca7844a80d6aa8a000c6a7e5272' 
           target='_blank' 
           style='color: #ff6b6b; text-decoration: none; font-weight: bold; font-size: 16px;'>
           üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞
        </a>
        <p style='margin-top: 10px; font-size: 12px; color: #ccc;'>–°—Å—ã–ª–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</p>

</div>
    """, unsafe_allow_html=True)
